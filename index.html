import React, { useMemo, useState, useEffect } from "react";

// === Вестник Держивории — оформленный сайт с лентой канала ===
// Макет: шапка + декоративный герой-блок + трёхколоночная сетка,
// по центру — эмбед Telegram канала t.me/derjivoria. Боковые колонки —
// статический контент/навигация, который можно развивать.
// Всё в одном файле, готово к деплою на Vercel/Netlify/GitHub Pages.

const TELEGRAM_CHANNEL = "derjivoria"; // канал для центральной ленты
const USE_EMBED_QUERY = true; // добавить ?embed=1 к ссылке

export default function VestnikDerjivoriiSite() {
  const [dark, setDark] = useState(true);

  useEffect(() => {
    document.documentElement.classList.toggle("dark", dark);
  }, [dark]);

  const iframeSrc = useMemo(() => {
    const base = `https://t.me/s/${TELEGRAM_CHANNEL}`;
    return USE_EMBED_QUERY ? `${base}?embed=1` : base;
  }, []);

  return (
    <div className="min-h-screen bg-[radial-gradient(ellipse_at_top,_rgba(234,234,234,0.6),_transparent_60%),radial-gradient(ellipse_at_bottom,_rgba(0,0,0,0.15),_transparent_60%)] dark:bg-[radial-gradient(ellipse_at_top,_rgba(28,28,28,0.7),_transparent_60%),radial-gradient(ellipse_at_bottom,_rgba(255,255,255,0.05),_transparent_60%)] text-neutral-900 dark:text-neutral-100">
      <TopBar dark={dark} onToggleTheme={() => setDark((v) => !v)} />
      <Hero />

      <main className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-14">
        <div className="grid grid-cols-1 lg:grid-cols-[280px,minmax(0,1fr),280px] gap-6">
          {/* Левая колонка */}
          <aside className="space-y-6 order-2 lg:order-1">
            <Card title="О Вестнике">
              <p className="text-sm leading-relaxed text-neutral-700 dark:text-neutral-300">
                «Вестник Держивории» — сатирические хроники, фольклор и добрые склоки
                нашей славной земли. Здесь — официальные заявления, неофициальные
                намёки и совершенно правдивые слухи.
              </p>
            </Card>
            <Card title="Рубрики">
              <ul className="text-sm space-y-2 text-neutral-800 dark:text-neutral-200">
                <li>• Новости Кутеж-града</li>
                <li>• Полевые записки из «Ельника»</li>
                <li>• Официальные указы (иногда)</li>
                <li>• Фольклор и существа</li>
                <li>• Объявления рынка</li>
              </ul>
            </Card>
            <Card title="Связи">
              <div className="flex flex-col gap-2 text-sm">
                <a className="underline-offset-2 hover:underline" href={`https://t.me/${TELEGRAM_CHANNEL}`} target="_blank" rel="noreferrer noopener">Telegram канал</a>
                <a className="underline-offset-2 hover:underline" href="#" onClick={(e)=>e.preventDefault()}>Derjivoria Games</a>
                <a className="underline-offset-2 hover:underline" href="#" onClick={(e)=>e.preventDefault()}>Архив (скоро)</a>
              </div>
            </Card>
          </aside>

          {/* Центральная колонка — лента Telegram */}
          <section className="order-1 lg:order-2">
            <div className="rounded-3xl border border-neutral-200 dark:border-neutral-800 shadow-sm overflow-hidden bg-white/80 dark:bg-neutral-900/60 backdrop-blur">
              <div className="px-4 py-3 bg-neutral-100/70 dark:bg-neutral-800/60 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <OrnamentSmall />
                  <div className="text-sm"><span className="opacity-70">Лента:</span> <b>@{TELEGRAM_CHANNEL}</b></div>
                </div>
                <span className="hidden md:inline text-xs opacity-70">Если лента не загрузилась — откройте в Telegram</span>
              </div>
              <div className="relative w-full" style={{ height: "min(160vh, 1200px)" }}>
                <iframe
                  title="Лента Telegram"
                  src={iframeSrc}
                  className="w-full h-full bg-white dark:bg-neutral-950"
                  loading="lazy"
                  sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                />
              </div>
            </div>
          </section>

          {/* Правая колонка */}
          <aside className="space-y-6 order-3">
            <Card title="Из редакции">
              <ul className="text-sm space-y-2">
                <li>— Пишите нам в личку канала с наводками.</li>
                <li>— Иллюстрации приветствуются, но без табуретов повсюду.</li>
                <li>— Уточнения по канону Держивории — в комментариях.</li>
              </ul>
            </Card>
            <Card title="Закрепы (ссылки)">
              <ul className="text-sm list-disc pl-5 space-y-2">
                <li><a className="hover:underline" href={`https://t.me/${TELEGRAM_CHANNEL}`} target="_blank" rel="noreferrer noopener">Открыть канал в Telegram</a></li>
                <li><a className="hover:underline" href={`https://t.me/s/${TELEGRAM_CHANNEL}`} target="_blank" rel="noreferrer noopener">Открыть публичную ленту</a></li>
              </ul>
            </Card>
            <Card title="Поддержать Вестник">
              <p className="text-sm opacity-90">Можете прислать баранок, грибов и добрых слов. Денежные жертвы тоже воспринимаем с достоинством.</p>
              <button className="mt-3 w-full text-sm px-3 py-2 rounded-xl border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800">Написать редакции</button>
            </Card>
          </aside>
        </div>
      </main>

      <SiteFooter />
    </div>
  );
}

function TopBar({ dark, onToggleTheme }: { dark: boolean; onToggleTheme: () => void }) {
  return (
    <header className="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-neutral-950/60 border-b border-neutral-200 dark:border-neutral-800">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <Logo />
          <nav className="hidden md:flex items-center gap-4 text-sm">
            <a className="hover:underline underline-offset-4" href="#">Новости</a>
            <a className="hover:underline underline-offset-4" href="#">О проекте</a>
            <a className="hover:underline underline-offset-4" href="#">Архив</a>
          </nav>
        </div>
        <div className="flex items-center gap-2">
          <a
            href={`https://t.me/${TELEGRAM_CHANNEL}`}
            target="_blank"
            rel="noreferrer noopener"
            className="text-sm px-3 py-1.5 rounded-xl border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800"
          >
            Открыть в Telegram
          </a>
          <button
            onClick={onToggleTheme}
            className="text-sm px-3 py-1.5 rounded-xl border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800"
            aria-label="Переключить тему"
          >
            {dark ? "Светлая" : "Тёмная"}
          </button>
        </div>
      </div>
    </header>
  );
}

function Hero() {
  return (
    <section className="relative overflow-hidden">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-8 pb-10">
        <div className="rounded-3xl border border-neutral-200 dark:border-neutral-800 p-6 md:p-8 bg-white/70 dark:bg-neutral-900/50 backdrop-blur shadow-sm">
          <div className="flex items-start gap-6">
            <div className="hidden sm:block"><OrnamentTall /></div>
            <div className="flex-1">
              <h1 className="text-3xl md:text-5xl font-black leading-tight">
                Вестник Держивории
              </h1>
              <p className="mt-3 text-neutral-700 dark:text-neutral-300 max-w-2xl">
                Официально-народные известия, сатирические хроники и фольклорные происшествия.
                Ниже — прямая трансляция публикаций из Telegram-канала.
              </p>
              <div className="mt-4 flex flex-wrap items-center gap-3">
                <Badge>Не ханжим</Badge>
                <Badge>Фольклор</Badge>
                <Badge>Сатира</Badge>
              </div>
            </div>
            <div className="hidden md:block rotate-180"><OrnamentTall /></div>
          </div>
        </div>
      </div>
    </section>
  );
}

function SiteFooter() {
  return (
    <footer className="border-t border-neutral-200 dark:border-neutral-800">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 text-sm text-neutral-600 dark:text-neutral-400 flex flex-col md:flex-row items-start md:items-center justify-between gap-3">
        <div>
          © {new Date().getFullYear()} «Вестник Держивории». Все совпадения с реальностью — чистая случайность, если что.
        </div>
        <div className="flex gap-4">
          <a className="hover:underline" href={`https://t.me/${TELEGRAM_CHANNEL}`} target="_blank" rel="noreferrer noopener">Telegram</a>
          <a className="hover:underline" href="#" onClick={(e)=>e.preventDefault()}>Правила подачи новостей</a>
          <a className="hover:underline" href="#" onClick={(e)=>e.preventDefault()}>Контакты</a>
        </div>
      </div>
    </footer>
  );
}

function Card({ title, children }: { title: string; children: React.ReactNode }) {
  return (
    <div className="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/50 backdrop-blur p-4 shadow-sm">
      <div className="flex items-center gap-3 mb-3">
        <OrnamentSmall />
        <h3 className="font-semibold tracking-tight">{title}</h3>
      </div>
      {children}
    </div>
  );
}

function Badge({ children }: { children: React.ReactNode }) {
  return (
    <span className="text-xs px-2.5 py-1 rounded-full border border-neutral-300 dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-800">
      {children}
    </span>
  );
}

function Logo() {
  return (
    <div className="flex items-center gap-2">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" className="shrink-0">
        <circle cx="12" cy="12" r="11" className="stroke-current" strokeWidth="1.5" fill="none" />
        <path d="M5 12h14M12 5v14" className="stroke-current" strokeWidth="1.5" strokeLinecap="round" />
      </svg>
      <span className="text-xl md:text-2xl font-extrabold tracking-tight">Вестник Держивории</span>
    </div>
  );
}

function OrnamentSmall() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" className="opacity-50">
      <path d="M12 2l2.4 4.8L20 8l-4 4 1 5-5-2.6L7 17l1-5-4-4 5.6-1.2L12 2z" fill="currentColor" />
    </svg>
  );
}

function OrnamentTall() {
  return (
    <svg width="20" height="120" viewBox="0 0 20 120" className="opacity-50">
      <path d="M10 0v120" stroke="currentColor" strokeWidth="1"/>
      <circle cx="10" cy="12" r="3" fill="currentColor"/>
      <circle cx="10" cy="36" r="3" fill="currentColor"/>
      <circle cx="10" cy="60" r="3" fill="currentColor"/>
      <circle cx="10" cy="84" r="3" fill="currentColor"/>
      <circle cx="10" cy="108" r="3" fill="currentColor"/>
    </svg>
  );
}
